/**
 * Created with JetBrains PhpStorm.
 * User: Laurentiu
 * Date: 8/28/13
 * Time: 11:51 AM
 * To change this template use File | Settings | File Templates.
 */
$(document).ready(function(){
var TEXT='';
   $('.editcomment').click(function(event){

       var paragraf=$(this).parent().get(0);

       if(typeof $(this).next().prop("tagName") != 'undefined'){
            var time=$(paragraf).children().eq(0).children().eq(0).text();
           var link=$(this).attr('href')+'/'+time+'/'+$(paragraf).children().eq(4).val();


           $.ajax(link)
               .done(function(){
                   var t=$(paragraf).children().eq(4).val();
                   $(paragraf).children().eq(4).remove();
                   $(paragraf).children().eq(3).remove();
                   $(paragraf).children().eq(0).after('<p></p>');
                   $(paragraf).children().eq(1).text(TEXT);

                   $(paragraf).children().eq(1).slideUp('slow',function(){
                       $(paragraf).children().eq(1).html(t);
                       $(paragraf).children().eq(1).slideDown('slow');
                   });
               })
               .fail(function(){
                alert('Server down!!')
               });
           return false;

       }
       else {
           var text=$(paragraf).children().eq(1).text();
           TEXT=text;
           $(paragraf).children().eq(1).remove();
           var input= $('<textarea name="comment_text" id="change"></textarea> ');
           $(paragraf).children().eq(2).after(input);
           $(paragraf).children().eq(3).before(
               '<a href="" class="canceleditcomment">Cancel</a> '
           );
           $('.canceleditcomment').click(function(){
               var paragraf=$(this).parent().get(0);
               $(paragraf).children().eq(4).remove();
               $(paragraf).children().eq(3).remove();
               $(paragraf).children().eq(0).after('<p></p>');
               $(paragraf).children().eq(1).text(TEXT);
               return false;
           });
           $(paragraf).children().eq(4).html(text);

           return false;
       }



   });

    $('.deletecomment').click(function(){

        var div=$(this).parent();
        var time=$(div).children().eq(0).children().eq(0).text().substr(0,20);
        var link=$(this).attr('href')+"/"+time;
        $.ajax(link)
            .done(function(){
              $(div).slideUp('slow');
            })
            .fail(function(){alert("Server down!!")});
        return false;
    });

    $('input#bold').click(function(){
       var textarea=$(this).parent().children().eq(4);
        $(textarea).val($(textarea).val()+'<b></b>');
    });
    $('input#italic').click(function(){
        var textarea=$(this).parent().children().eq(4);
        $(textarea).val($(textarea).val()+'<i></i>');
    });
    $('#color').change(function(){
        var textarea=$(this).parent().children().eq(4);

        $(textarea).val($(textarea).val()+"<font color='"+$(this).val()+"'></font>");

    });
    $('#underline').click(function(){
        var textarea=$(this).parent().children().eq(4);
        $(textarea).val($(textarea).val()+'<u></u>');
    });

    $('a.meniu').on('mouseenter',function(){
      $(this).css('color','red');
        $(this).css('background-color','black');
    });
    $('a.meniu').on('mouseleave',function(){
       $(this).css('color','black');
        $(this).css('background-color','lightgray');
    });


});